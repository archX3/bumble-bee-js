var Barge=Barge||{};
(function(k,d){"function"===typeof define&&define.amd?define([],function(){return k.TabbedView=d(k)}):"object"===typeof exports?module.exports=d(k):k.TabbedView=d(k)})(window,function(k){function d(a,c,b){this.parent=a;this.INDEX=0;this.tabHeadNames=c;this.list=this.panesHost=this.tabsHost=null;this.tabs=[];this.panes=[];this.sortable=this.activePane=this.activeTab=this.addButton=null;this.options={defaultActiveTabNumber:1,closeButtons:!1,tabHeadLocation:"top",sortHeads:!1,icons:!1,keepState:!0,keepSortHeadsState:!0,
tabbedViewID:null,canAddTab:!1,addButtonCallback:null,canRemoveTab:!1,maxNumberOfTabs:9,genericTabName:"Untitled Tab",autoCreate:!0,scrollablePanes:!1};b&&(this.options=e.extend(this.options,b));!0===this.options.autoCreate&&this.create()}Barge.Dom=Barge.Dom||{};var e=Barge.utils,l=Barge.String,g=Barge.Dom,m=Barge.Object,n=new Barge.Event.EventManager;d.prototype.create=function(){var a=g.createEl("div",{className:"tabbedView"},this.options.style);a.appendChild(this._renderTabHeads(this.tabHeadNames));
a.appendChild(this._renderPanes(this.tabHeadNames));this.parent&&(e.isString(this.parent)&&(this.parent=g.getEl(this.parent)),g.insertChildAt(this.parent,a,this.INDEX));document.querySelectorAll(".tabbedView .tabHead");this._addClickEvent();!0===this.options.keepState&&e.defined(this.options.tabbedViewID)&&!l.isEmpty(this.options.tabbedViewID)&&(a=localStorage.getItem(this.options.tabbedViewID),a=g.getElementsByAttribute("data-pane",a,!0),e.defined(a)&&e.defined(a.click)&&a.click())};d.prototype._addClickEvent=
function(){var a=this;n.bind(this.list,"click",function(c){var b=c.target;if(b.classList.contains("tabCloseBtn"))a.closeTab(b);else{var h=Barge.utils.gebi(b.getAttribute("data-pane").toString());document.querySelector(".activePane");a._setActive(b,"tabHead","activeTabHead");a.activeTab=b;a._setActive(h,"pane","activePane");a.activePane=h;!0===a.options.keepState&&localStorage.setItem(a.options.tabbedViewID,b.getAttribute("data-pane").toString())}c.stopPropagation()})};d.prototype._createSorter=function(){e.defined(k.DragSorter)&&
(this.sortable=null,this.sortable=new DragSorter(this.list,{group:"",animation:200,delay:0,chosenClass:"chosenSortItem",store:!0===this.options.keepSortHeadsState?{get:function(a){return(a=localStorage.getItem("tv"+a.options.group))?a.split("|"):[]},set:function(a){var c=a.toArray();localStorage.setItem("tv"+a.options.group,c.join("|"))}}:null}))};d.prototype.createTab=function(a,c,b,h,f){c=void 0===c?null:c;f=void 0===f?null:f;b=g.createEl("li",{className:((void 0===h?0:h)?"addButton":"tabHead")+
(void 0===b?"":b)},{userSelect:"none",paddingRight:this.options.canRemoveTab?"3px":"10px"});b.setAttribute("data-pane","pane"+e.pInt(a+1));b.setAttribute("data-count",a+1);a=g.createEl("a",{href:"#",innerHTML:c?c:this.options.genericTabName},{userSelect:"none",pointerEvents:"none"});console.log(f);e.defined(f)&&(f=g.createEl("span",{className:"tabIcon tabIco"},e.defined(f.style)?f.style:null),b.appendChild(f));b.appendChild(a);this.options.canRemoveTab&&(f=g.createEl("span",{className:"tabCloseBtn",
innerHTML:"&times;"},{marginLeft:"10px"}),b.appendChild(f));this.tabs.push(b);this.list.appendChild(b)};d.prototype._renderTabHeads=function(){var a=this;this.tabsHost=g.createEl("div",{className:"tabHeads"});this.list=g.createEl("ul",{id:"tHeadsUl"});if(e.isArray(a.tabHeadNames))e.forEach(a.tabHeadNames,function(b,c){a.createTab(c,a.tabHeadNames[c],c===a.options.defaultActiveTabNumber-1?" activeTabHead":"")});else if(e.isObject(a.tabHeadNames)){var c=0;m.forEach(a.tabHeadNames,function(b){c++;var h=
e.defined(b.activeTab)&&!0===b.activeTab?" activeTabHead":"";a.createTab(c,b.tabName,h,!1,e.defined(b.icon)?b.icon:null)})}this.tabsHost.appendChild(this.list);!0===this.options.sortHeads&&this._createSorter();if(!0===a.options.canAddTab){var b=g.createEl("ul"),h=g.createEl("li",{className:"addButton"},{userSelect:"none",padding:"2px",fontWeight:600,lineHeight:1,minWidth:"19px",textAlign:"center"}),f=g.createEl("span",{href:"#",innerHTML:"+"},{userSelect:"none"});h.appendChild(f);b.appendChild(h);
a.tabsHost.appendChild(b);a.addButton=h;n.bind(this.addButton,"click",function(b){a.addTab(a.options.genericTabName+" "+(a.list.children.length+1));null!==a.options.addButtonCallback&&a.options.addButtonCallback()});h=f=null}return this.tabsHost};d.prototype.createPane=function(a,c,b,h,f,d){b=void 0===b?!1:b;f=void 0===f?{}:f;d=void 0===d?null:d;a=g.createEl("div",{className:"pane"+(void 0===a?"":a),id:"pane"+e.pInt(c+1)},f);!0===this.options.scrollablePanes&&g.css(a,{overflowY:"auto"});(b=b?document.getElementById(b):
d?d:null)&&a.appendChild(b);this.panes.push(a);this.panesHost.appendChild(a)};d.prototype._renderPanes=function(){var a=this;this.panesHost=g.createEl("div",{className:"panes"},e.defined(a.options.panesHostStyle)?a.options.panesHostStyle:null);if(e.isArray(a.tabHeadNames))e.forEach(a.tabHeadNames,function(b,c){b=g.createEl("div",{className:"pane"+(c===a.options.defaultActiveTabNumber-1?" activePane":""),id:"pane"+e.pInt(c+1)});(c=document.getElementById(l.toPascalCase(a.tabHeadNames[c],!0)))&&b.appendChild(c);
a.panes.push(b);a.panesHost.appendChild(b)});else if(e.isObject(a.tabHeadNames)){var c=0;m.forEach(a.tabHeadNames,function(b){c++;var d=e.defined(b.activeTab)&&!0===b.activeTab?" activePane":"";a.createPane(d,c,b.containerID,b.tabName,e.defined(b.style)?b.style:{})})}return this.panesHost};d.prototype._setActive=function(a,c,b){if(a&&!a.classList.contains(b)){var d=a.parentNode;d=d.children;for(var f=0,e=d.length;f<e;f++)d[f].className=c;a.className=b;"tabHead"===c?this.activeTab=a:"pane"===c&&(this.activePane=
a)}};d.prototype.addTab=function(a){if(this.list.children.length<this.options.maxNumberOfTabs){var c=this.tabs.length+1;this.createTab(c,a,"");this.createPane("",c,!1,a);this.list.children[this.list.children.length-1].click()}};d.prototype.closeTab=function(a){var c=Barge.utils.gebi(a.parentElement.getAttribute("data-pane").toString());if(a.parentElement.classList.contains("activeTabHead")&&1<this.list.children.length){var b=g.indexOf(this.list,a.parentElement);0===b?this.list.children[1].click():
this.list.children[b-1].click()}g.closeWin(a.parentElement,!0);g.closeWin(c,!0)};d.prototype.getActiveTabHead=function(){};d.prototype.getActivePane=function(){return this.activePane};d.prototype.getActiveTab=function(){return this.activeTab};d.prototype.setTabName=function(a){};d.prototype.destroy=function(){};return Barge.Dom.TabbedView=d});
