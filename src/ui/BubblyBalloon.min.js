(function(k,c){"function"===typeof define&&define.amd?define([],function(){return k["Barge.BubblyBalloon"]=c(k)}):"object"===typeof exports?module.exports=c(k):k["Barge.BubblyBalloon"]=c(k)})(window,function(k){function c(a){this.options={dragToClose:!0,balloonSpace:40,_maxBalloonCount:4,_maxTWBalloonCount:6,balloonPosition:"br"};f.defined(a)&&(this.options=f.extend(this.options,a));this.balloons=[];this.balloonCount=0;this.twBalloons=[];this.twBalloonCount=0;this.balloonTimers={};this.twBalloonTimers=
{};this.timerUID=0}var f=Bee.Utils,l=Bee.Array,h=Bee.Object,g=Bee.Widget,n=new Bee.Event.EventManager;c.prototype.balloon=function(a){a.type="balloon";this.getBalloonCount("balloon")>=this.options._maxBalloonCount?(this.pauseAllTimers(a),a.balloonEl=this.getFirstBalloon("balloon"),this.dismiss(a),this.render(a),this.resumeAllTimers(a)):this.render(a)};c.prototype.toolWindowBalloon=function(a){this.render(a)};c.prototype.addCloseButton=function(a,b){var d=this,e=g.createEl("button",{className:"closeBtn",
innerHTML:"&times;"});n.bind(e,"click",function(){d.pauseAllTimers(a);b.hasAttribute("data-tid")&&h.remove(d.balloonTimers,b.getAttribute("data-tid"));d.dismiss(a);d.resumeAllTimers(a)});b.appendChild(e)};c.prototype.render=function(a){if("balloon"===a.type){var b=g.createEl("div",{className:"balloon"}),d=f.defined(this.getLastBalloon("balloon"))?this.getLastBalloon("balloon").offsetHeight:null;this.getBalloonCount("balloon");var e=0<=this.balloonCount?++this.balloonCount:this.balloonCount=1;g.css(b,
{bottom:(null!==d?100<d?140:100:100)*(e-1)+this.options.balloonSpace*e+"px"});b.setAttribute("data-id",this.balloonCount.toString());a.balloonEl=b;d=g.createEl("div",{className:"balMsg"});this.addCloseButton(a,b);e=g.createEl("p",{innerHTML:a.message});d.appendChild(e);b.appendChild(d);this.balloons.push(b);!0===a.autoClose&&(a.balloonEl=b,this.makeAutoClosable(a));!0===this.options.dragToClose&&this.makeClosableOnSlide(a);g.appendToWindow(b)}};c.prototype.getBalloonCount=function(a){if("balloon"===
a)return this.balloons.length};c.prototype.getMaxBalloonCount=function(a){if("balloon"===a)return this._maxBalloonCount};c.prototype.getLastBalloon=function(a){if("balloon"===a)return this.balloons[this.balloons.length-1]};c.prototype.getFirstBalloon=function(a){if("balloon"===a)return this.balloons[0]};c.prototype.makeAutoClosable=function(a){var b=this,d="tid"+this.timerUID++,e=a.delay||5E3;a.balloonEl.setAttribute("data-tid",d);this.balloonTimers[d]=new Bee.Timer(function(){h.remove(b.balloonTimers,
d);b.dismiss(a)},e)};c.prototype.makeClosableOnSlide=function(a){new function(a,d){d=void 0===d?{}:d;var b=this;this.dragOptions={};f.extend(this.dragOptions,d);b.toBeMoved=a;g.addClass(b.toBeMoved,"draggable");var c=b.toBeMoved.offsetLeft;a.addEventListener("mousedown",function(e){function h(a){a.preventDefault();a.clientX>c&&(b.toBeMoved.style.left=p+a.clientX-m+"px")}function l(a){f.defined(d.tolerance)&&(a.clientX-c<d.tolerance?b.toBeMoved.style.left=c+"px":(a=b.toBeMoved.getElementsByClassName("closeBtn")[0],
b.toBeMoved.style.left=k.innerWidth+50+"px",a.click()));document.removeEventListener("mousemove",h,!1);document.removeEventListener("mouseup",l,!1)}e.stopPropagation();var p=parseInt(g.getCss(b.toBeMoved,"left")),m=e.clientX;e.target==a&&(document.addEventListener("mouseup",l,!1),document.addEventListener("mousemove",h,!1))},!1)}(a.balloonEl,{prevDef:!1,tolerance:200})};c.prototype.handleBalloonClose=function(a){var b=this;--this.balloonCount;var c=f.pInt(a.getAttribute("data-id"));l.forEach(this.balloons,
function(a,d){d=f.pInt(a.getAttribute("data-id"));if(d>c){var e=a.getBoundingClientRect().height+b.options.balloonSpace;g.css(a,{bottom:f.getStyleValue("bottom",a)-e+"px"});a.setAttribute("data-id",d-1)}})};c.prototype.dismiss=function(a){if("balloon"===a.type){this.handleBalloonClose(a.balloonEl);var b=this.balloons.indexOf(a.balloonEl);g.closeWin(a.balloonEl,!0);l.removeAt(this.balloons,b)}if(f.defined(a.onDismiss)&&f.isFunction(a.onDismiss))a.onDismiss()};c.prototype.dismissAll=function(a){var b=
this;"balloon"===a.type&&(this.pauseAllTimers(a),l.forEach(this.balloons,function(a,c){b.dismiss(a)}))};c.prototype.pauseAllTimers=function(a){"balloon"===a.type&&(h.isEmpty(this.balloonTimers)||h.forEach(this.balloonTimers,function(a){a.pause()}))};c.prototype.resumeAllTimers=function(a){"balloon"===a.type&&(h.isEmpty(this.balloonTimers)||h.forEach(this.balloonTimers,function(a){a.resume()}))};c.prototype.twb=c.toolWindowBalloon;var m=new c;Bee.BubblyBalloon={balloon:function(a){m.balloon(a)},toolWindowBalloon:function(a){m.toolWindowBalloon(a)}};
return Bee.BubblyBalloon});
