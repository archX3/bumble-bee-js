var Bee=Bee||{};
(function(d,n){function t(a,b){var c=null;c=d.createEl("div",{className:"toolWindowBalloon"},{top:30*h++ +"px"});c.setAttribute("data-count",h.toString());a=n.createEl("p",{innerHTML:a});var e=d.createEl("button",{className:"closeBtn",innerHTML:"&times;"});e.onclick=function(){--h;for(var a=document.querySelectorAll(".toolWindowBalloon"),c=0;c<a.length;c++)if(parseInt(a[c].getAttribute("data-count"))>parseInt(this.parentElement.getAttribute("data-count"))){var b=d.getStyleValue(a[c].style.top);a[c].style.top=
b-30+"px";b=parseInt(a[c].getAttribute("data-count"))-1;a[c].setAttribute("data-count",b.toString())}d.closeWin(this.parentElement,!0,!0);1==a.length&&d.closeWin(d.gebi("balloonStyle"),!0,!0)};if(b)var f=setTimeout(function(){--h;for(var a=document.querySelectorAll(".toolWindowBalloon"),b=0;b<a.length;b++)if(parseInt(a[b].getAttribute("data-count"))>parseInt(c.getAttribute("data-count"))){var e=d.getStyleValue(a[b].style.bottom);a[b].style.bottom=e-19+"%";console.log(a[b].getAttribute("data-count"));
e=parseInt(a[b].getAttribute("data-count"))-1;a[b].setAttribute("data-count",e.toString())}d.closeWin(c,!0,!0);1==a.length&&d.closeWin(d.gebi("balloonStyle"),!0,!0);clearTimeout(f)},5E3);c.appendChild(a);c.appendChild(e);c.classList.add("tada");return c}function u(a,b){if(a){var c=document.createElement("h5");c.innerHTML="warning"==b||"alert"==b?"<i class='fa  fa-warning fw' style='color: #f00;'></i>  "+a.toString():"info"==b?"<i class='fa fa-info-circle fw' style='color: #00a5ff;'></i>  "+a.toString():
"question"==b?"<span class='msgIcon msgIconQues' style='color: #ffc600; background-color: rgba(255, 253, 209, 1);border-color: #ffc600'>&#xE11B;</span>"+a.toString():"ok"==b||"success"==b?"<i class='fa fa-check-circle fw' style='color: #04e704; background-color: #e8ffe7'></i>  "+a.toString():"failure"==b?"<i class='fa fa-times-circle fw' style='color: #f00;'></i>  "+a.toString():"delete"==b?"<i class='fa fa-trash fw' style='color: #f00;'></i>  "+a.toString():a.toString()}return c}function p(a){--k;
for(var b=document.querySelectorAll(".balloon"),c=0;c<b.length;c++)if(parseInt(b[c].getAttribute("data-count"))>parseInt(a.getAttribute("data-count"))){var e=d.getStyleValue(b[c].style.bottom);b[c].style.bottom=e-(b[c].offsetHeight+q.balSpace)+"px";e=d.pInt(b[c].getAttribute("data-count"))-1;b[c].setAttribute("data-count",e.toString())}d.closeWin(a,!0,!0);l.removeLastBalloon();a=l.getBalloons();l.setLastBalloon(a[a.length-1])}function v(a,b,c,e,f){var g=d.createEl("div",{className:"balloon"}),m=d.defined(l.getLastBalloon())?
l.getLastBalloon().offsetHeight:null,h=0<=k?++k:k=1;d.css(g,{bottom:(null!==m?100<m?140:100:100)*(h-1)+q.balSpace*h+"px"});g.setAttribute("data-count",k.toString());m=d.createEl("button",{className:"closeBtn",innerHTML:"&times;"});m.addEventListener("click",function(){clearTimeout(r);p(g)});if(b){f=f||5E3;20>f&&0<f&&(f*=1E3);var r=setTimeout(function(){clearTimeout(r);p(g)},f)}a=d.createEl("p",{innerHTML:a});g.appendChild(m);g.appendChild(u(c,e));g.appendChild(a);g.classList.add("tada");return g}
var k=0,h=0,q={dragToClose:!0,balSpace:40};Bee.BubblyBalloon={_maxBalloonCount:4,_maxTWBalloonCount:6,_balloons:[],_firstBalloon:null,_lastBalloon:null,addBalloon:function(a){this._balloons.push(a)},removeLastBalloon:function(){return this._balloons.pop()},getMaxBalloonCount:function(){return this._maxBalloonCount},getMaxTWBalloonCount:function(){return this._maxTWBalloonCount},setMaxBalloonCount:function(a){this._maxBalloonCount=a},setMaxTWBalloonCount:function(a){this._maxTWBalloonCount=a},getFirstBalloon:function(){return this._firstBalloon},
setFirstBalloon:function(a){this._firstBalloon=a},getLastBalloon:function(){return this._lastBalloon},setLastBalloon:function(a){this._lastBalloon=a},getBalloons:function(){return this._balloons},setBalloons:function(a){this._balloons=a},_makeTWBalloon:function(a,b){if(h>=this._maxTWBalloonCount){for(var c=document.querySelectorAll(".toolWindowBalloon"),e=0;e<c.length;e++){var f=d.getStyleValue(c[e].style.top);c[e].style.top=f-30+"px";f=parseInt(c[e].getAttribute("data-count"))-1;c[e].setAttribute("data-count",
f.toString())}d.closeWin(d.qs(".toolWindowBalloon"),!0,!0);--h}document.body.appendChild(t(a,b))},_makeBalloon:function(a,b,c,e,f){var g=d.qs(".balloon");k>=this._maxBalloonCount&&p(g);a=v(a,b,c,e,f);this.setLastBalloon(a);document.body.appendChild(a);1==q.dragToClose&&this._makeCloseableByDrag(a)},toolWindowBalloon:function(a){this._makeTWBalloon(a,!0)},stickyToolWindowBalloon:function(a){this._makeTWBalloon(a,!1)},stickyBalloon:function(a,b,c){this._makeBalloon(a,!1,b,c)},balloon:function(a,b,c,
e){this._makeBalloon(a,!0,b,c,e)},_makeCloseableByDrag:function(a){new function(a,c){c=void 0===c?{}:c;var b=this;this.dragOptions={};d.extend(this.dragOptions,c);b.toBeMoved=a;n.addClass(b.toBeMoved,"draggable");var f=b.toBeMoved.offsetLeft;a.addEventListener("mousedown",function(e){e.stopPropagation();var g=parseInt(n.getCss(b.toBeMoved,"left"));if(e.target==a){var h=function(a){d.defined(c.tolerance)&&(a.clientX-f<c.tolerance?b.toBeMoved.style.left=f+"px":(a=b.toBeMoved.getElementsByClassName("closeBtn")[0],
b.toBeMoved.style.left=window.innerWidth+50+"px",a.click()));document.removeEventListener("mousemove",k,!1);document.removeEventListener("mouseup",h,!1)},k=function(a){a.preventDefault();a.clientX>f&&(b.toBeMoved.style.left=g+a.clientX-l+"px")},l=e.clientX;document.addEventListener("mouseup",h,!1);document.addEventListener("mousemove",k,!1)}},!1)}(a,{prevDef:!1,tolerance:200})},closeAllBalloons:function(){var a=d.qsa(".balloon");d.defined(a)&&d.forEach(a,function(a){a.getElementsByClassName("closeBtn")[0].click()})}};
var l=Bee.BubblyBalloon;window.TWB=Bee.BubblyBalloon.toolWindowBalloon})(Bee.utils,Bee.Dom);
