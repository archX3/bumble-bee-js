var Barge=Barge||{};
(function(d,n,z,c){Barge.Dom=Barge.Dom||{};var r=d.getStyleValue,m=0,y=document.documentElement.style;Barge.Dom.Toolbox=function(a,b){d.assert(d.defined(window)&&d.defined(document),"Barge.Dom.Toolbox a window object as host");d.assert(d.defined(a.toolBoxID)||d.defined(a.toolBoxListNodeID)||d.defined(a.toolBoxItemsClassName),"Barge.Dom.Toolbox expects non-null params: toolBoxNodeID, toolBoxListNodeID, toolBoxItemsClassName");this.options={toolBoxID:"toolBox",toolBoxListNodeID:"toolBoxList",toolBoxItemsClassName:"toolBoxItem",
elOnRight:null,elOnLeft:null,elOnTop:null,elOnBottom:null,ShowOnLeft:!0,varyFlyOutPosition:!1,expandable:!0,recurse:!1,switchOnHover:!0,keepState:!0,swapToolBoxIcons:!1,keepPosition:!0,trackMouseMove:!1,useNativeShortcut:!1,unDockable:!0,floatingWidth:null,floatingHeight:null};this.dragOptions={prevDef:!1,moveParent:!0,tolerance:30,floatingHeight:null};a&&(this.options=d.extend(this.options,a));b&&(this.dragOptions=d.extend(this.dragOptions,b));this.toolBox=c.getEl("#"+this.options.toolBoxID);this.list=
c.getEl("#"+this.options.toolBoxListNodeID);this.toolTip=this.expandBtn=this.thumbGrip=this.toolBoxItems=null;this.toolTipProps={leftOffset:0,topOffset:0};this.len=this.i=0;this.aFlyOutIsOpen=!1;window.toolBoxFlyOutIsOpen=this.aFlyOutIsOpen;this.toolTipIsShowing=this.toolBoxActivated=!1;this.openFlyOut=null;this.docked=!0;this.toBeMovedHeight=this.toBeMovedWidth=null;this.Be=new Barge.Event.EventManager;this.aFlyOutIsOpen=!1;this.expansionStyleSheet=this.dynamicStyleSheet=null};Barge.Dom.Toolbox.prototype.addDynamicStyleSheet=
function(){this.dynamicStyleSheet=d.createEl("style",{id:"toolboxDStyle"});this.expansionStyleSheet=d.createEl("style",{id:"toolboxDxStyle"});c.appendToHead([this.dynamicStyleSheet,this.expansionStyleSheet])};Barge.Dom.Toolbox.prototype.swapIcons=function(a,b,f){var e=a.children[0].children[0],h=a.parentElement.previousElementSibling.children[0],g=a.children[0].getElementsByClassName("shortCut")[0],k="";!1===this.options.useNativeShortcut?(d.defined(e.getAttribute("data-tbTip"))?k+=e.getAttribute("data-tbTip"):
e.title&&!n.isEmpty(e.title)&&(k+=e.title),k+=g?"  ("+g.innerHTML+")":""):k=e.title+(g?"  ("+g.innerHTML+")":"");this.options.keepState&&(g=this.toolBoxItems.indexOf(a.parentElement.parentElement),b=b.indexOf(a),localStorage.setItem("toolBoxItem"+g,b));g=c.hasChildren(a.children[0].children[0]);c.removeEl(h);h=a.parentElement.previousElementSibling;b=d.createEl("span");d.extend(b,{className:e.className});g||d.extend(b,{innerHTML:e.innerHTML});c.css(b,e.style);g&&(g=d.createEl(e.children[0].tagName.toLocaleLowerCase()),
d.extend(g,{className:e.children[0].className}),c.css(g,e.children[0].style),c.css(g,{textAlign:"center",width:"25px",height:"25px"}),b.appendChild(g));!1===this.options.useNativeShortcut?(f.setAttribute("data-tbTip",k),b.title=""):d.extend(f,{title:n.isEmpty(k)?"":k});h.appendChild(b);d.defined(a.children[0].href)&&!n.isEmpty(a.children[0].href)&&d.extend(f,{href:a.children[0].href});d.defined(a.getAttribute("data-window"))&&!n.isEmpty(a.getAttribute("data-window"))&&f.setAttribute("data-window",
a.getAttribute("data-window"))};Barge.Dom.Toolbox.prototype._closeAllFlyOuts=function(a){if(this.toolBoxItems)for(this.i=0,this.len=a.length;this.i<this.len;this.i++){var b=a[this.i].children[1];a[this.i].children[1]&&"UL"===b.tagName&&c.closeWin(b)}};Barge.Dom.Toolbox.prototype._haveFlyOutOpen=function(a){return(a=a.children[1])&&"UL"===a.tagName&&"block"===a.style.display};Barge.Dom.Toolbox.prototype._resetToolBoxSize=function(a,b){d.defined(b.floatingWidth)&&d.css(a,{width:b.floatingWidth+10+"px"});
d.defined(b.floatingHeight)&&d.css(a,{height:b.floatingHeight+7+"px"})};Barge.Dom.Toolbox.prototype._getDisplayState=function(a){return"none"===a.style.display||""===a.style.display?0:1};Barge.Dom.Toolbox.prototype._openWin=function(a){0===d.getDisplayState(a)&&c.setDisplayState(a,"block")};Barge.Dom.Toolbox.prototype._insertCustomToolTip=function(a){var b=this;d.forEach(b.toolBoxItems,function(a){a.children[0]&&(a.children[0].title="")});if(!a){b.toolTip=c.createEl("div",{id:"toolTip"},{top:0,left:0,
display:"none"});c.appendToWindow(b.toolTip);var f;a=d.getElementsByAttribute("data-tbTip");this.Be.bindOnAll(a,"mouseover",function(a){if(!1===b.aFlyOutIsOpen){a=this.parentElement;var e=c.getRight(a)/2-6,g=(!c.getEl("#propertyBar")||c.getEl("#propertyBar")&&!b.docked?6:46)+(0===d.pInt(b.toolTipProps.topOffset)||b.docked?30:d.pInt(b.toolTipProps.topOffset));c.alignLeft(a,b.toolTip,b.toolTipProps.leftOffset);c.anchorBottom(a,b.toolTip,g);c.setPseudoStyle(b.toolTip,"before","left",e+"px");a=this.getAttribute("data-tbTip").split(",");
var k=!n.isEmpty(a[0]);b.toolTip.innerHTML=a[0];f=setTimeout(function(){clearTimeout(f);k&&(d.openWin(b.toolTip),b.toolTipIsShowing=!0)},300)}},!1);this.Be.bindOnAll(a,"mouseout",function(a){0===b._getDisplayState(b.toolTip)?clearTimeout(f):f=setTimeout(function(){clearTimeout(f);d.closeWin(b.toolTip);b.toolTipIsShowing=!1},100)})}};Barge.Dom.Toolbox.prototype.addClickEvent=function(){var a=this;this.Be.bindOnAll(a.toolBoxItems,"click",function(b){var f=this.children[1]?this.children[1]:null,e=this.children[0];
b=b.target;this.children[1]&&"UL"===f.tagName?1===a._getDisplayState(f)?(c.closeWin(f),c.css(e,{backgroundColor:""}),a.openFlyOut=null,a.aFlyOutIsOpen=!1,window.toolBoxFlyOutIsOpen=!1):(a.toolBoxActivated||(a._closeAllFlyOuts(a.toolBoxItems,!0),a.toolBoxActivated=!0),a.aFlyOutIsOpen&&c.closeWin(a.openFlyOut),a.toolTipIsShowing&&d.defined(c.getEl("#toolTip"))&&c.closeWin(c.getEl("#toolTip")),c.css(e,{backgroundColor:"var(--menuItemHoverColor)"}),a._openWin(f),a.toolTip&&1===a._getDisplayState(a.toolTip)&&
(c.closeWin(this.toolTip),this.toolTipIsShowing=!1),a.openFlyOut=f,a.dynamicStyleSheet.innerHTML="#toolBox ul ul{left : calc(100% + 2px)}",m=d.pInt(c.getRight(a.openFlyOut))+d.pInt(a.toolTipProps.leftOffset),a.options.showOnLeft=m<=window.innerWidth-3,!1===a.options.showOnLeft&&(a.dynamicStyleSheet.innerHTML="#toolBox ul ul{right : calc(100% + 2px)}"),a.aFlyOutIsOpen=!0,window.toolBoxFlyOutIsOpen=!0):(c.css(e,{backgroundColor:"var(--menuItemHoverColor)"}),toolBoxFlyOutIsOpen=a.aFlyOutIsOpen=!0);if(b.nextElementSibling!==
f||b.parentNode!==this)c.css(e,{backgroundColor:""}),toolBoxFlyOutIsOpen=a.aFlyOutIsOpen=!1})};Barge.Dom.Toolbox.prototype.addMouseOutEvent=function(){var a=this;this.Be.bindOnAll(this.toolBoxItems,"mouseout",function(){a.openFlyOut&&c.css(this.children[0],{backgroundColor:""})})};Barge.Dom.Toolbox.prototype.addMouseOverEvent=function(){var a=this;this.Be.bindOnAll(this.toolBoxItems,"mouseover",function(b){if(a.aFlyOutIsOpen){b=this.children[1];var f=this.children[0];this.children[1]&&"UL"===b.tagName?
(c.closeWin(a.openFlyOut),a._openWin(b),a.aFlyOutIsOpen=!0,a.openFlyOut=b,a.dynamicStyleSheet.innerHTML="#toolBox ul ul{left : calc(100% + 2px)}",!0===a.options.varyFlyOutPosition&&(m=d.pInt(c.getRight(b))+d.pInt(a.toolTipProps.leftOffset),console.log(m),a.options.showOnLeft=m<=window.innerWidth-3),!1===a.options.showOnLeft&&(a.dynamicStyleSheet.innerHTML="#toolBox ul ul{right : calc(100% + 2px)}")):c.closeWin(a.openFlyOut);d.defined(f)&&c.css(f,{backgroundColor:"var(--menuItemHoverColor)"})}})};
Barge.Dom.Toolbox.prototype.addCloseOutEventOnBodyClick=function(){var a=this;this.Be.bind(window,"mouseup",function(b){var d=b.target.tagName?"body"===b.target.tagName.toLowerCase()||"html"===b.target.tagName.toLowerCase():null;a.aFlyOutIsOpen&&(b.target.parentNode.classList&&!b.target.parentNode.classList.contains("toolBoxItem")?(c.closeWin(a.openFlyOut),a.aFlyOutIsOpen=!1):d&&(c.closeWin(a.openFlyOut),a.aFlyOutIsOpen=!1))})};Barge.Dom.Toolbox.prototype.createThumb=function(){this.thumbGrip=d.createEl("div",
{className:"hDockThumb"});!0===this.options.expandable&&(this.expandBtn=d.createEl("div",{className:"expandBtn fa fa-angle-double-right"},{position:"relative",float:"right",height:"100%",width:"10px",fontSize:"8px",textAlign:"right",lineHeight:"6px",fontWeight:"600"}),this.dynamicStyleSheet.innerHTML+=".expandBtn:hover{ color:#fff;}",this.thumbGrip.appendChild(this.expandBtn));c.insertChildAt(this.toolBox,this.thumbGrip,0)};Barge.Dom.Toolbox.prototype.addClassNameToList=function(){this.toolBoxItems=
d.nodeListToArray(this.list.children);var a=this;d.forEach(this.toolBoxItems,function(b){c.addClass(b,a.options.toolBoxItemsClassName)})};Barge.Dom.Toolbox.prototype.dock=function(){d.css(this.toolBox,{top:0,left:0});this.docked=!0;!0===this.options.keepState&&!0===this.options.keepPosition&&localStorage.setItem("toolBoxDockState","true")};Barge.Dom.Toolbox.prototype.makeUnDockable=function(){var a=this;c.css(a.toolBox,{width:a.toolBox.offsetWidth,height:a.toolBox.offsetHeight,border:"1px solid var(--dividerColor)",
borderTop:"none"});new function(b,f){f=void 0===f?{}:f;var e=this,h=d.defined(c.getEl("#propertyBar")),g=h?c.getEl("#propertyBar"):null;d.extend(f,f);e.moveParent=f.moveParent||null;e.toBeMoved=null;this.dragOptions=f;e.toBeMoved=e.moveParent?b.parentElement:b;a.toBeMovedWidth=e.toBeMoved.offsetWidth;a.toBeMovedHeight=e.toBeMoved.offsetHeight;c.addClass(e.toBeMoved,"draggable");c.css(e.toBeMoved,{position:"relative",left:e.toBeMoved.offsetLeft,top:e.toBeMoved.offsetTop,zIndex:e.toBeMoved.style.zIndex+
20,transition:"all .07s"});var k=e.toBeMoved.offsetLeft,n=e.toBeMoved.offsetTop,l=c.createEl("div");c.css(l,e.toBeMoved.style);d.extend(l,{id:"",innerHTML:""});c.css(l,{display:"none",position:"absolute",borderLeft:"2px solid #0078ff",borderTop:"none",borderRight:"none",borderBottom:"none",zIndex:e.toBeMoved.style.zIndex-1,backgroundColor:"rgba(8, 124, 255, 0.3)",top:c.getTop(e.toBeMoved)+"px"});document.body.appendChild(l);var m=!1;b.addEventListener("mousedown",function(p){c.css(l,{width:a.toBeMovedWidth+
"px",height:a.toBeMovedHeight+"px"});p.stopPropagation();var t=parseInt(window.getComputedStyle(e.toBeMoved).left),v=parseInt(window.getComputedStyle(e.toBeMoved).top);if(p.target==b){var x=function(f){c.css(b,{cursor:"default"});a.toolTipProps.leftOffset=d.pInt(r("left",e.toBeMoved));a.toolTipProps.topOffset=d.pInt(r("top",e.toBeMoved));m=1===c.getDisplayState(l);(0>=a.toolTipProps.leftOffset||m)&&a.dock();a.docked?(d.css(e.toBeMoved,{width:a.toBeMovedWidth+"px",height:a.toBeMovedHeight+(h?40:0)+
"px",top:n-(h&&"none"===g.style.display?40:0)+"px",borderTop:"none",boxShadow:"none"}),y.setProperty("--toolBoxWith",a.toolBox.style.width)):(d.css(e.toBeMoved,{position:"absolute",border:"1px solid var(--dividerColor)",boxShadow:"0px 0px 3px rgba(0, 0, 0, 0.6)"}),e.dragOptions.floatingWidth&&d.css(e.toBeMoved,{width:e.dragOptions.floatingWidth+10+"px"}),e.dragOptions.floatingHeight&&d.css(e.toBeMoved,{height:e.dragOptions.floatingHeight+7+"px"}),!0===a.options.keepState&&!0===a.options.keepPosition&&
localStorage.setItem("toolBoxDockState","false"),31>r("top",e.toBeMoved)&&(e.toBeMoved.style.top="31px"),d.defined(a.options.elOnRight)&&Barge.Dom.CSSSTYLE.setProperty("--toolBoxWith","0px"));if(!0===a.options.keepState&&!0===a.options.keepPosition&&!0===a.options.unDockable){f=c.getLeft(e.toBeMoved).toString();var k=c.getTop(e.toBeMoved).toString();localStorage.setItem("toolBoxXY",f+","+k)}document.removeEventListener("mousemove",w,!1);document.removeEventListener("mouseup",x,!1)},w=function(g){if(f.tolerance){c.css(b,
{cursor:"move"});var h=d.getStyleValue("left",e.toBeMoved);10<=h&&h<=a.toBeMovedWidth&&!a.docked?c.openWin(l):c.closeWin(l);a.docked?(h=g.clientY-u,g.clientX-q>f.tolerance&&(c.css(toolBox,{left:t+g.clientX-q+"px"}),a.docked=!1),10<h&&(c.css(toolBox,{top:v+g.clientY-u+"px"}),a.docked=!1)):h<=f.tolerance+5?(d.css(e.toBeMoved,{left:k+"px"}),c.closeWin(l),a.docked=!0):e.toBeMoved.style.left=t+g.clientX-q+"px"}else e.toBeMoved.style.left=t+g.clientX-q+"px";31>g.clientY?e.toBeMoved.style.top="31px":31<=
g.clientY&&!a.docked&&(e.toBeMoved.style.top=v+g.clientY-u+"px")},q=p.clientX,u=p.clientY;document.addEventListener("mouseup",x,!1);document.addEventListener("mousemove",w,!1)}},!1)}(a.thumbGrip,{prevDef:!1,moveParent:!0,tolerance:30,floatingHeight:a.list.offsetHeight+a.thumbGrip.offsetHeight})};Barge.Dom.Toolbox.prototype.makeStateful=function(){var a=this;if(!0===this.options.unDockable&&!0===this.options.keepPosition){var b=localStorage.getItem("toolBoxXY").split(","),c=localStorage.getItem("toolBoxDockState");
d.defined(c)&&"false"===c&&a._resetToolBoxSize(a.toolBox,{floatingHeight:a.toolBox.children[0].offsetHeight+a.toolBox.children[1].offsetHeight});d.defined(b)&&(d.css(a.toolBox,{left:b[0]+"px",top:b[1]+"px"}),a.toolTipProps.leftOffset=b[0],a.toolTipProps.topOffset=b[1])}a.options.swapToolBoxIcons&&d.forEach(a.toolBoxItems,function(b,c){b=localStorage.getItem("toolBoxItem"+c);var e=a.toolBoxItems[c].children[0];c=void 0!==a.toolBoxItems[c].children[1]&&void 0!==a.toolBoxItems[c].children[1].children?
d.nodeListToArray(a.toolBoxItems[c].children[1].children):null;d.defined(c)&&d.defined(b)&&d.defined(c[b])&&a.swapIcons(c[b],c,e)})};Barge.Dom.Toolbox.prototype.create=function(){this.addClassNameToList();this.addDynamicStyleSheet();d.defined(this.options.elOnRight)&&(this.options.elOnRight=c.getEl("#"+this.options.elOnRight));d.defined(this.options.elOnTop);this.options.unDockable?this.createThumb():d.css(this.toolBox,{paddingTop:"5px"});this.aFlyOutIsOpen=this.toolBoxItems.some(this._haveFlyOutOpen);
this.addClickEvent();!0===this.options.switchOnHover&&(this.addMouseOverEvent(),this.addMouseOutEvent());this.addCloseOutEventOnBodyClick();!1===this.options.useNativeShortcut&&this._insertCustomToolTip();!0===this.options.unDockable&&this.makeUnDockable();!0===this.options.keepState&&this.makeStateful()};Barge.Dom.Toolbox.prototype.hide=function(){c.css(this.toolBox,{display:"none"});!0===this.docked&&Barge.Dom.CSSSTYLE.setProperty("--toolBoxWith","0px")};Barge.Dom.Toolbox.prototype.show=function(){!0===
this.docked&&Barge.Dom.CSSSTYLE.setProperty("--toolBoxWith","40px");c.css(this.toolBox,{display:"block"})};Barge.Dom.Toolbox.prototype.getToolBoxFlyOutIsOpen=function(){return this.aFlyOutIsOpen};return{ToolBox:Barge.Dom.Toolbox,getToolBoxFlyOutIsOpen:Barge.Dom.Toolbox.prototype.getToolBoxFlyOutIsOpen}})(Barge.utils,Barge.String,Barge.Object,Barge.Dom);
