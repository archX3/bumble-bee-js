var Barge=Barge||{};
(function(r,h){"function"===typeof define&&define.amd?define([],function(){return r.tSorter=h(r)}):"object"===typeof exports?module.exports=h(r):r.tSorter=h(r)})(window,function(r){function h(a,c){this.tableEl=a;this.hasInputs=this.DATE_RE=null;this.options={rowStepping:1,DATE_RE:null};l.defined(c)&&(this.options=l.extend(this.options,c))}var l=Barge.utils,D=Barge.Array,n=Barge.Dom,J=new Barge.Event.EventManager,z=null,p=null,E=null,e=null,F=null,G=null,A=null,H=null,w=null,k=null,I=null,B=null,C=
null,q=null,x,t,y,m,u,v,b,d;h.prototype.init=function(){var a=this;l.assert(document.createElement||document.getElementsByTagName,"TableSorter requires document.createElement and document.getElementsByTagName");this.DATE_RE=/^(\d\d?)[\/\.-](\d\d?)[\/\.-]((\d\d)?\d\d)$/;l.defined(this.tableEl)?(n.addClass(this.tableEl,"sortable"),a.makeSortable(this.tableEl)):D.forEach(document.getElementsByTagName("table"),function(c){n.classListContains(c,"sortable")&&(console.log(a),a.makeSortable(c))})};h.prototype.makeSortable=
function(a){var c=this;0===a.getElementsByTagName("thead").length&&(z=document.createElement("thead"),z.appendChild(a.rows[0]),a.insertBefore(z,a.firstChild));null===a.tHead&&(a.tHead=a.getElementsByTagName("thead")[0]);if(1===a.tHead.rows.length){q=[];for(var f=0;f<a.rows.length;f++)n.hasClass(a.rows[f],"sortbottom")&&(q[q.length]=a.rows[f]);if(q){null===a.tFoot&&(A=document.createElement("tfoot"),a.appendChild(A));for(f=0;f<q.length;f++)A.appendChild(q[f]);q=null}k=a.tHead.rows[0].cells;for(f=0;f<
k.length;f++)if(!n.hasClass(k[f],"sortable_nosort")&&!n.hasClass(k[f],"noSort")){n.addClass(k[f],"sortableHead");e=k[f].className.match(/\bsortable_([a-z0-9]+)\b/);var b=void 0;e&&(b=e[1]);k[f].sortable_sortfunction=e&&"function"===typeof this["sort_"+b]?this["sort_"+b]:this.guessType(a,f);k[f].sortable_columnindex=f;k[f].sortable_tbody=a.tBodies[0];J.bind(k[f],"click",c.innerSortFunction=function(a){if(n.classListContains(this,"sortable_sorted"))c.reverse(this.sortable_tbody),this.className=this.className.replace("sortable_sorted",
"sortable_sorted_reverse");else if(-1!==this.className.search(/\bsortable_sorted_reverse\b/))c.reverse(this.sortable_tbody),this.className=this.className.replace("sortable_sorted_reverse","sortable_sorted");else{I=this.parentNode;D.forEach(I.childNodes,function(a){1===a.nodeType&&(a.className=a.className.replace("sortable_sorted_reverse",""),a.className=a.className.replace("sortable_sorted",""))});(C=document.getElementById("sortable_sortfwdind"))&&C.parentNode.removeChild(C);(B=document.getElementById("sortable_sortrevind"))&&
B.parentNode.removeChild(B);this.className+=" sortable_sorted";p=[];E=this.sortable_columnindex;w=this.sortable_tbody.rows;for(a=0;a<w.length;a+=c.options.rowStepping)p[p.length]=[c.getInnerText(w[a].cells[E]),w[a]];c.shakerSort(p,this.sortable_sortfunction);H=this.sortable_tbody;for(a=0;a<p.length;a++)H.appendChild(p[a][1]);p=null}})}}};h.prototype.guessType=function(a,c){for(var f=this.sortAlpha,b,e=0;e<a.tBodies[0].rows.length;e++)if(b=this.getInnerText(a.tBodies[0].rows[e].cells[c]),""!==b){if(b.match(/^-?[\u00a3$\u00a4]?[\d,.]+%?$/))return this.sortNumeric;
if(b=b.match(this.DATE_RE)){F=parseInt(b[1]);G=parseInt(b[2]);if(12<F)return this.sortDdMm;if(12<G)return this.sortMmDd;f=this.sortDdMm}}return f};h.prototype.getInnerText=function(a){if(!a)return"";this.hasInputs=l.isFunction(a.getElementsByTagName)&&a.getElementsByTagName("input").length;if(l.defined(a.getAttribute)&&null!==a.getAttribute("sortable_customkey"))return a.getAttribute("sortable_customkey");if(l.defined(a.textContent)&&!this.hasInputs)return a.textContent.replace(/^\s+|\s+$/g,"");if(l.defined(a.innerText)&&
!this.hasInputs)return a.innerText.replace(/^\s+|\s+$/g,"");if(l.defined(a.text)&&!this.hasInputs)return a.text.replace(/^\s+|\s+$/g,"");switch(a.nodeType){case 3:if("input"===a.nodeName.toLowerCase())return a.value.replace(/^\s+|\s+$/g,"");case 4:return a.nodeValue.replace(/^\s+|\s+$/g,"");case 1:case 11:for(var c="",b=0;b<a.childNodes.length;b++)c+=this.getInnerText(a.childNodes[b]);return c.replace(/^\s+|\s+$/g,"");default:return""}};h.prototype.reverse=function(a){t=[];for(var c=0;c<a.rows.length;c++)t[t.length]=
a.rows[c];for(c=t.length-1;0<=c;c--)a.appendChild(t[c]);t=null};h.prototype.sortNumeric=function(a,c){x=parseFloat(a[0].replace(/[^0-9.-]/g,""));isNaN(x)&&(x=0);y=parseFloat(c[0].replace(/[^0-9.-]/g,""));isNaN(y)&&(y=0);return x-y};h.prototype.sortAlpha=function(a,c){return a[0]==c[0]?0:a[0]<c[0]?-1:1};h.prototype.sortDdMm=function(a,c){e=a[0].match(this.DATE_RE);m=e[3];b=e[2];d=e[1];1===b.length&&(b="0"+b);1===d.length&&(d="0"+d);v=m+b+d;e=c[0].match(this.DATE_RE);m=e[3];b=e[2];d=e[1];1===b.length&&
(b="0"+b);1===d.length&&(d="0"+d);u=m+b+d;return v===u?0:v<u?-1:1};h.prototype.sortMmDd=function(a,c){e=a[0].match(this.DATE_RE);m=e[3];d=e[2];b=e[1];1===b.length&&(b="0"+b);1===d.length&&(d="0"+d);v=m+b+d;e=c[0].match(this.DATE_RE);m=e[3];d=e[2];b=e[1];1===b.length&&(b="0"+b);1===d.length&&(d="0"+d);u=m+b+d;return v===u?0:v<u?-1:1};h.prototype.shakerSort=function(a,c){for(var b=0,e=a.length-1,d=!0;d;){d=!1;for(var g=b;g<e;++g)0<c(a[g],a[g+1])&&(d=a[g],a[g]=a[g+1],a[g+1]=d,d=!0);e--;if(!d)break;for(g=
e;g>b;--g)0>c(a[g],a[g-1])&&(d=a[g],a[g]=a[g-1],a[g-1]=d,d=!0);b++}};return Barge.Dom.TableSorter=h});
